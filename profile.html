<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Your Profile - RemiderNova</title>
<link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600&display=swap" rel="stylesheet" />
<style>
  body {
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', Arial, sans-serif;
    background: #f5f5f5;
    color: #222;
    min-height: 100vh;
    overflow-x: hidden;
  }
  .container {
    max-width: 400px;
    background: #fff;
    padding: 2rem;
    border-radius: 1rem;
    margin: 2rem auto;
    box-shadow: 0 0 20px rgba(0,0,0,0.1);
    text-align: center;
    opacity: 0;
    transform: translateY(-100px); /* start up */
    animation: slideDown 0.8s ease forwards;
  }
  @keyframes slideDown {
    to { opacity: 1; transform: translateY(0); }
  }
  .profile-pic {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: #ccc center/cover;
    cursor: pointer;
    margin: 0 auto 1rem;
    border: 3px solid #007bff;
  }
  h2 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
  }
  input.username-input {
    padding: 0.5rem;
    border: 1px solid #ccc;
    border-radius: 0.3rem;
    width: 80%;
    text-align: center;
    font-size: 1rem;
    margin-bottom: 1rem;
  }
  .discord-btn {
    padding: 0.8rem 1.5rem;
    background: #007bff;
    color: #fff;
    border: none;
    border-radius: 0.3rem;
    cursor: pointer;
    font-weight: bold;
    text-decoration: none;
    display: inline-block;
  }
  .discord-btn:hover {
    background: #0056b3;
  }
</style>
</head>
<body>

<div class="container">
  <div id="profile-pic" class="profile-pic" title="Click to change profile picture"></div>
  <h2 id="username-display"></h2>
  <input id="username-input" class="username-input" placeholder="Change username..." />

  <br/>
  <a href="https://discord.gg/your-invite-link" target="_blank" class="discord-btn">Join Us On Discord</a>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-storage.js"></script>

<script>
  // TODO: put your firebase config here
  const firebaseConfig = {
    apiKey: "AIzaSyB5vtpjJEGlyXAupMWkzbDXK0f2TSm2VWQ",
    authDomain: "remidernova-login.firebaseapp.com",
    projectId: "remidernova-login",
    storageBucket: "remidernova-login.firebasestorage.app",
    messagingSenderId: "304712721460",
    appId: "1:304712721460:web:2ab74eccc3b2de33de1661"
  };
  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  const profilePicEl = document.getElementById('profile-pic');
  const usernameDisplay = document.getElementById('username-display');
  const usernameInput = document.getElementById('username-input');

  auth.onAuthStateChanged(async (user) => {
    if (user) {
      profilePicEl.style.backgroundImage = `url(${user.photoURL || ''})`;
      usernameDisplay.innerText = user.displayName || user.email;
      usernameInput.value = user.displayName || '';
    } else {
      window.location.href = "index.html"; // back to login if not logged in
    }
  });

  // Save username when changed
  usernameInput.addEventListener('change', async () => {
    const user = auth.currentUser;
    if (user) {
      await user.updateProfile({ displayName: usernameInput.value });
      usernameDisplay.innerText = usernameInput.value;
      await db.collection('users').doc(user.uid).set(
        { username: usernameInput.value },
        { merge: true }
      );
      alert('Username updated.');
    }
  });

  // Upload profile picture
  profilePicEl.onclick = () => {
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = 'image/*';
    fileInput.onchange = async (e) => {
      const file = e.target.files[0];
      if (file) {
        const ref = storage.ref(`profilePics/${auth.currentUser.uid}.jpg`);
        await ref.put(file);
        const url = await ref.getDownloadURL();
        await auth.currentUser.updateProfile({ photoURL: url });
        profilePicEl.style.backgroundImage = `url(${url})`;
        await db.collection('users').doc(auth.currentUser.uid).set(
          { profilePic: url },
          { merge: true }
        );
        alert('Profile picture updated.');
      }
    };
    fileInput.click();
  };
</script>
</body>
  </html>
